{% extends "cash_flow/base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Управление справочниками</h1>
    <a href="{% url 'index' %}" class="btn btn-primary">
        <i class="bi bi-arrow-left"></i> На главную
    </a>
</div>

<div class="card">
    <div class="card-header bg-primary">
        <ul class="nav nav-pills" id="dictionariesTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active bg-white text-primary fw-bold me-2" data-bs-toggle="tab" data-bs-target="#statuses" type="button">
                    <i class="bi bi-bookmark-check"></i> Статусы
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link bg-white text-primary fw-bold me-2" data-bs-toggle="tab" data-bs-target="#types" type="button">
                    <i class="bi bi-tags"></i> Типы
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link bg-white text-primary fw-bold me-2" data-bs-toggle="tab" data-bs-target="#categories" type="button">
                    <i class="bi bi-folder"></i> Категории
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link bg-white text-primary fw-bold" data-bs-toggle="tab" data-bs-target="#subcategories" type="button">
                    <i class="bi bi-folder2-open"></i> Подкатегории
                </button>
            </li>
        </ul>
    </div>
    
    <div class="card-body">
        <div class="tab-content" id="dictionariesTabContent">
            <!-- Вкладка статусов -->
            <div class="tab-pane fade show active" id="statuses">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Статусы</h3>
                    <a href="{% url 'status_create' %}" class="btn btn-success">
                        <i class="bi bi-plus"></i> Добавить
                    </a>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Используется в</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for status in statuses %}
                        <tr>
                            <td>{{ status.name }}</td>
                            <td>{{ status.cashflow_set.count }} записях</td>
                            <td>
                                <a href="{% url 'status_update' status.pk %}" class="btn btn-sm btn-warning">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'status_delete' status.pk %}" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Вкладка типов -->
            <div class="tab-pane fade" id="types">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Типы операций</h3>
                    <a href="{% url 'type_create' %}" class="btn btn-success">
                        <i class="bi bi-plus"></i> Добавить
                    </a>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Используется в</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for type in types %}
                        <tr>
                            <td>{{ type.name }}</td>
                            <td>{{ type.cashflow_set.count }} записях</td>
                            <td>
                                <a href="{% url 'type_update' type.pk %}" class="btn btn-sm btn-warning">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'type_delete' type.pk %}" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Вкладка категорий -->
            <div class="tab-pane fade" id="categories">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Категории</h3>
                    <a href="{% url 'category_create' %}" class="btn btn-success">
                        <i class="bi bi-plus"></i> Добавить
                    </a>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Подкатегорий</th>
                            <th>Используется в</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category in categories %}
                        <tr>
                            <td>{{ category.name }}</td>
                            <td>{{ category.subcategory_set.count }}</td>
                            <td>{{ category.cashflow_set.count }} записях</td>
                            <td>
                                <a href="{% url 'category_update' category.pk %}" class="btn btn-sm btn-warning">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'category_delete' category.pk %}" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Вкладка подкатегорий -->
            <div class="tab-pane fade" id="subcategories">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Подкатегории</h3>
                    <a href="{% url 'subcategory_create' %}" class="btn btn-success">
                        <i class="bi bi-plus"></i> Добавить
                    </a>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Категория</th>
                            <th>Используется в</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for subcategory in subcategories %}
                        <tr>
                            <td>{{ subcategory.name }}</td>
                            <td>{{ subcategory.category }}</td>
                            <td>{{ subcategory.cashflow_set.count }} записях</td>
                            <td>
                                <a href="{% url 'subcategory_update' subcategory.pk %}" class="btn btn-sm btn-warning">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'subcategory_delete' subcategory.pk %}" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// Активация табов при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    const hash = window.location.hash;
    if (hash) {
        const tabTrigger = new bootstrap.Tab(document.querySelector(`[data-bs-target="${hash}"]`));
        tabTrigger.show();
    }
});
</script>
{% endblock %}